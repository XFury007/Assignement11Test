<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:MauiBankingExercise.ViewModel"
             x:Class="MauiBankingExercise.Views.AccountsPage"
             Title="Banking Accounts"
             BackgroundColor="#F8F9FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Control Styles switched from Frame to Border -->
            <Style x:Key="BaseFrameStyle" TargetType="Border">
                <Setter Property="Padding" Value="16" />
                <Setter Property="Margin" Value="0,6" />
                <Setter Property="Background" Value="White" />
                <Setter Property="Stroke" Value="Transparent" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="StrokeShape">
                    <Setter.Value>
                        <RoundRectangle CornerRadius="8" />
                    </Setter.Value>
                </Setter>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="#000000" Opacity="0.12" Offset="0,2" Radius="8" />
                    </Setter.Value>
                </Setter>
            </Style>
            
            <Style x:Key="ErrorFrameStyle" TargetType="Border" BasedOn="{StaticResource BaseFrameStyle}">
                <Setter Property="Background" Value="#FFF1F1" />
                <Setter Property="Stroke" Value="Transparent" />
            </Style>
            
            <Style x:Key="SuccessFrameStyle" TargetType="Border" BasedOn="{StaticResource BaseFrameStyle}">
                <Setter Property="Background" Value="#ECFDF3" />
                <Setter Property="Stroke" Value="Transparent" />
            </Style>
            
            <Style x:Key="AccountCardStyle" TargetType="Border" BasedOn="{StaticResource BaseFrameStyle}">
                <Setter Property="Background" Value="White" />
                <Setter Property="Stroke" Value="#E4E7EB" />
            </Style>
            
            <Style x:Key="PrimaryButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#0078D4" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="6" />
                <Setter Property="Padding" Value="16,10" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
            
            <Style x:Key="SecondaryButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#5A6268" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="6" />
                <Setter Property="Padding" Value="16,10" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="16">
        <VerticalStackLayout Grid.Row="0" Spacing="12">
            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0" 
                        Text="Reload Accounts"
                        Command="{Binding ReloadAccountsCommand}" 
                        Style="{StaticResource PrimaryButtonStyle}" />
                
                <Button Grid.Column="1" 
                        Text="Test API Connection"
                        Command="{Binding TestApiCommand}" 
                        Style="{StaticResource SecondaryButtonStyle}" />
            </Grid>

            <!-- API Connection Status -->
            <Border IsVisible="{Binding ApiConnected}"
                   Style="{StaticResource SuccessFrameStyle}">
                <HorizontalStackLayout Spacing="8">
                    <Label Text="?" 
                           FontSize="18"
                           TextColor="#12B76A"
                           VerticalOptions="Center" />
                    <Label Text="API Connected Successfully" 
                           TextColor="#12B76A" 
                           FontAttributes="Bold"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!-- Loading indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                               IsVisible="{Binding IsLoading}" 
                               Color="#0078D4"
                               HeightRequest="40" 
                               HorizontalOptions="Center" />

            <!-- Error message -->
            <Border IsVisible="{Binding HasError}"
                   Style="{StaticResource ErrorFrameStyle}">
                <VerticalStackLayout Spacing="8">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="??" 
                               FontSize="18"
                               TextColor="#D92D20"
                               VerticalOptions="Center" />
                        <Label Text="Connection Error" 
                               FontAttributes="Bold" 
                               TextColor="#D92D20" 
                               FontSize="16"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    
                    <Label Text="{Binding ErrorMessage}" 
                           TextColor="#D92D20"
                           Margin="0,4,0,8" />
                    
                    <Border Background="#FEF3F2" 
                           Padding="12">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6" />
                        </Border.StrokeShape>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Troubleshooting Steps:" 
                                   FontSize="13" 
                                   FontAttributes="Bold"
                                   TextColor="#667085" />
                            <Label Text="1. Make sure the Banking API is running" 
                                   FontSize="12" 
                                   TextColor="#667085" />
                            <Label Text="2. Check network connectivity" 
                                   FontSize="12" 
                                   TextColor="#667085" />
                            <Label Text="3. Verify the API URL is correct" 
                                   FontSize="12" 
                                   TextColor="#667085" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>

        <!-- Accounts List -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*">
            <!-- Empty state message -->
            <VerticalStackLayout 
                 IsVisible="{Binding HasAccounts, Converter={StaticResource InvertedBoolConverter}}"
                 HorizontalOptions="Center"
                 VerticalOptions="Center"
                 Grid.Row="0"
                 Margin="0,40,0,0"
                 Spacing="12">
                <Image Source="account_empty.png" 
                       HeightRequest="100" 
                       IsVisible="False" />
                <Label Text="No accounts found"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#101828"
                       HorizontalOptions="Center" />
                <Label Text="Try reloading or make sure the Banking API is running."
                       FontSize="14"
                       TextColor="#667085"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- Accounts collection -->
            <CollectionView Grid.Row="1"
                            ItemsSource="{Binding Accounts}"
                            SelectionMode="None"
                            Margin="0,8,0,0">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource AccountCardStyle}" 
                               Margin="0,6">
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">
                                <!-- Account Number & Type Badge -->
                                <HorizontalStackLayout Grid.Column="0" Grid.Row="0" Spacing="12">
                                    <Label Text="{Binding AccountNumber}" 
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           TextColor="#101828"/>
                                    
                                    <Border Background="#F2F4F7" 
                                           Padding="8,4">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="4" />
                                        </Border.StrokeShape>
                                        <Label Text="Savings" 
                                               FontSize="12"
                                               TextColor="#344054"/>
                                    </Border>
                                </HorizontalStackLayout>
                                
                                <!-- Balance -->
                                <Label Grid.Column="2" Grid.Row="0"
                                       Text="{Binding AccountBalance, StringFormat='{0:C}'}"
                                       FontAttributes="Bold"
                                       FontSize="18"
                                       VerticalOptions="Center"
                                       HorizontalOptions="End"
                                       TextColor="#039855"/>
                                
                                <!-- Customer Info -->
                                <HorizontalStackLayout Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" 
                                                      Spacing="8"
                                                      Margin="0,8,0,0">
                                    <Label Text="Owner:" 
                                           FontSize="14"
                                           TextColor="#667085"/>
                                    <Label Text="{Binding Customer.FirstName}" 
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           TextColor="#344054"/>
                                    <Label Text="{Binding Customer.LastName}" 
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           TextColor="#344054"/>
                                </HorizontalStackLayout>
                                
                                <!-- Account Status -->
                                <HorizontalStackLayout Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="3" 
                                                      Spacing="8"
                                                      Margin="0,4,0,0">
                                    <Label Text="Status:" 
                                           FontSize="14"
                                           TextColor="#667085"/>
                                    <Label Text="{Binding IsActive, StringFormat='{0}'}" 
                                           FontSize="14"
                                           TextColor="#12B76A"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                        HorizontalOptions="Center"
                                        Spacing="12">
                        <Label Text="No accounts available"
                               FontSize="16"
                               TextColor="#667085"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>
